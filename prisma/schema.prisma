generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  male
  female
  other
}

/// @map("password_reset_tokens")
model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  user_id   String
  expiresAt DateTime
  user      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("password_reset_tokens")
}

/// @map("users")
model User {
  id             String          @id @default(uuid())
  email          String          @unique
  password_hash  String?
  name           String?
  gender         Gender?     
  is_vip         Boolean         @default(false)
  birth_date     DateTime?
  birth_time     String?
  birth_place    String?
  created_at     DateTime        @default(now())

  partner_name     String?
  partner_gender   Gender?
  partner_birth_date DateTime?
  partner_birth_time String?
  partner_birth_place String?
  relationship_start_date DateTime? 

  vip_tier       String          @default("FREE")
  vip_expires_at DateTime?
  reminder       Reminder?
  subscriptions  Subscription[]
  usageStats     UsageStats?
  passwordResetTokens PasswordResetToken[]
  chatSessions        ChatSession[]
}

/// @map("reminders")
model Reminder {
  user_id       String    @id
  is_subscribed Boolean   @default(true)
  frequency     String    @default("daily")
  last_sent     DateTime?
  user          User      @relation(fields: [user_id], references: [id])
}

/// @map("token_blocklist")
model TokenBlocklist {
  id        String   @id @default(uuid())
  jti       String   @unique
  expiresAt DateTime
}

/// @map("subscriptions")
model Subscription {
  id             String   @id @default(uuid())
  user_id        String
  tier           String
  price          Int
  start_date     DateTime @default(now())
  end_date       DateTime
  status         String   @default("active")
  payment_method String?
  transaction_id String?
  created_at     DateTime @default(now())
  user           User     @relation(fields: [user_id], references: [id])
}

/// @map("usage_stats")
model UsageStats {
  id                     String   @id @default(uuid())
  user_id                String   @unique
  tarot_readings_today   Int      @default(0)
  chat_messages_today    Int      @default(0)
  astrology_today        Int      @default(0)
  fortune_today          Int      @default(0)
  numerology_today       Int      @default(0)
  last_reset_date        DateTime @default(now())
  user                   User     @relation(fields: [user_id], references: [id])
}

/// @map("chat_sessions")
model ChatSession {
  id           String    @id @default(uuid())
  user_id      String    @db.Text
  title        String?   @db.Text
  created_at   DateTime  @default(now())
  updated_at   DateTime  @updatedAt
  
  user         User      @relation(fields: [user_id], references: [id])

  @@index([user_id])
  @@map("chat_sessions")
}
